# BlogPythonFlask
A personal Blog with Python and Flask through Pycharm
 
3 TIER WEB APPLICATION
Personal Blog With Flask
 
 
Εισαγωγή

Για την εργασία αυτή, έχει επιλεγεί η δημιουργία μιας εφαρμογής blog.
Σε αυτήν την εφαρμογή υπάρχει σύστημα διαχείρισης χρηστών, δηλαδή, δυνατότητα εγγραφής, εισόδου και εξόδου. Υπάρχει δυνατότητα προβολής λογαριασμού χρήστη, ενημέρωση φωτογραφίας προφίλ, αλλά και η δυνατότητα αλλαγής κωδικού πρόσβασης μέσω μαιλ. 
Πέρα του συστήματος διαχείρισης χρηστών, υπάρχει η δυνατότητα δημοσίευσης άρθρων όπου θα μπορούν να είναι αναγνώσιμα από χρήστες και μη, αλλά η δυνατότητα ενημέρωσης ή διαγραφής των άρθρων θα είναι καθαρά ανά χρήστη/ιδιοκτήτη άρθρου.
Η εφαρμογή αυτή αποτελείτε από 3 επίπεδα.  Το επίπεδο των δεδομένων αποτελείτε από μία σχεσιακή βάση δεδομένων. Το ενδιάμεσο επίπεδο είναι μία web υπηρεσία ή Flask η οποία διαχειρίζεται την πρόσβαση στα δεδομένα και την κατανομή της στης χρήστες και τέλος, το επίπεδο του user interface αποτελείται από μία web based εφαρμογή την HTML5.
Για την δημιουργία της εφαρμογής χρησιμοποιήθηκε η εφαρμογή PyCharm.
Το PyCharm είναι ένα ολοκληρωμένο περιβάλλον ανάπτυξης (IDE) που χρησιμοποιείται στον προγραμματισμό υπολογιστών, ειδικά για τη γλώσσα Python. Αναπτύσσεται από την τσεχική εταιρεία JetBrains. Παρέχει ανάλυση κώδικα, γραφικό εργαλείο εντοπισμού σφαλμάτων, ολοκληρωμένο έλεγχο συσκευών, ολοκλήρωση με συστήματα ελέγχου εκδόσεων (VCSes) και υποστηρίζει την ανάπτυξη ιστού με το Flask. 
Ανοίχτηκε νέο Project Flask με όνομα Personal Blog και αυτό μας δίνει τη δυνατότητα να τρέξουμε το project με προ-εγκατεστημένο το Flask. 
Μέσα στο Project αυτό θα ανοιχτούν οι εξής φάκελοι/packages.
Ο λόγος της  αρχικοποίηση αυτής της εφαρμογής γίνεται σε packages είναι για να μην γίνεται άσκοπη επανάληψη κώδικα αλλά και για είναι πιο εύκολη όποια αλλαγή χρειαστεί αν χρειαστεί στην πορεία.

Ανάλυση Επιπέδου 1 – User Interface
Σε αυτήν την εφαρμογή ο χρήστης θα μπορεί να κάνει εγγραφή και είσοδο στο σύστημα, θα έχει την δυνατότητα να ανανέωσης των στοιχείων του αλλά και να αλλάξει τον κωδικό του σε περίπτωση που το ξεχάσει. Ο χρήστης θα μπορεί επίσης να ενημερώσει την εικόνα προφίλ του σε περίπτωση που δεν θα θέλει να κρατήσει την αρχικοποιημένη (default) εικόνα από το σύστημα.
Επιπλέον θα έχει την δυνατότητα να ανεβάζει άρθρα τα οποία θα μπορεί να αποθηκεύει, ανανεώνει ακόμα και διαγράφει αρκεί να έχει πρόσβαση στο λογαριασμό χρήστη που τα έγγραψε.
Τέλος θα μπορεί να διαβάζει τα άρθρα όλων των χρηστών αλλά θα μπορεί να μεταβάλει μόνο σε αυτά που έχει πρόσβαση χρήστη.
Το user interface γράφτηκε και σχεδιάστηκε με γνώμονα την προσαρμοστικότητα της εφαρμογής σε πολλαπλά user end συσκευές με προτεραιότητα στα κινητά τηλέφωνα. Για την επίτευξη των παραπάνω χαρακτηριστικών έγινε χρήση Bootstrap, CSS και HTML5 
 
Ανάλυση Επιπέδου 2  - Flask

Στο δεύτερο επίπεδο χρησιμοποιήθηκε Flask.
Το Flask είναι ένα micro web framwork γραμμένο στην Python. Είναι ταξινομημένο ως microframework επειδή δεν απαιτεί ειδικά εργαλεία ή βιβλιοθήκες. Δεν διαθέτει στρώμα αφαίρεσης βάσεων δεδομένων, επικύρωση φόρμας ή άλλα στοιχεία, όπου οι προϋπάρχουσες βιβλιοθήκες τρίτων παρέχουν κοινές λειτουργίες. Ωστόσο, το Flask υποστηρίζει επεκτάσεις που μπορούν να προσθέσουν λειτουργίες εφαρμογής σαν να είχαν εφαρμοστεί στο ίδιο το Flask. 
Θα γίνει αρχικοποίηση της εφαρμογής αυτής σε πολλαπλά packages ανάλογα με την λειτουργία του κάθε module ούτως ώστε να είναι πιο εύκολη η παραμετροποίηση της εφαρμογής. Η ευκολία αλλά και η διαφορά στην δημιουργία πολλών packages αντί module είναι καθαρά στο επίπεδο συστήματος αρχείων και όταν χρειαστεί να εισαχθεί ένα package μόνο οι μεταβλητές, λειτουργίες και classes που βρίσκονται μέσα στο αρχείο __init__.py είναι άμεσα ορατές, όχι τα υπο-πακέτα και οι ενότητες.
Το module από μόνο του είναι ένα λογισμικό που έχει συγκεκριμένη λειτουργία. 
Με γνώμονα τα παραπάνω υπάρχουν αναλυτικά τα παρακάτω packages όπως φαίνεται και στην εικόνα 3.
 
1.	users: Ο φάκελος αυτός θα περιέχει τα εξής αρχεία python:
a.	__init__.py
b.	forms.py
c.	routes.py
d.	utiles.py
2.	posts: Ο φάκελος αυτός περιέχει το __init__.py, forms.py και routes.py
3.	main: Ο φάκελος αυτός περιέχει το __init__.py και routes.py
4.	static: Ο φάκελος αυτός περιέχει το main.css που έχει τη βασική μορφοποίηση των html σελίδων και των υποφάκελο profile_pics όπου και αποθηκεύονται οι φωτογραφίες προφίλ που ανεβάζει ο χρήστης.
5.	templates: Σε αυτόν τον φάκελο υπάρχουν όλα τα html αρχεία. 
6.	errors: Ο φάκελος αυτός περιέχει το __init__.py και handlers.py
Το __init__py αρχείο είναι σε κάποια packages άδειο. Η δημιουργία αυτού του αρχείου είναι αναγκαστική για να θεωρηθεί αυτός ο φάκελος από την python ως package.
7.	Και τα εξής  βασικά αρχεία python:
•	__init__.py
•	config.py
•	models.py
•	run.py Αυτό το αρχείο έχει δημιουργηθεί καθαρά για να εισάγει την εφαρμογή και να την τρέχει.
•	site.db Είναι η σχεσιακή βάση δεδομένων SQLAlchemy
Βασικά modules της εφαρμογής

Στα βασικά modules της εφαρμογής έχουμε αναλυτικά το __init__.py
Σε αυτό το αρχείο βρίσκεται η αρχικοποίηση της εφαρμογής και γίνεται η ομαδοποίηση διάφορων στοιχείων.
Στο αρχείο models.py γίνεται χρήση των λειτουργιών datetime, TimedJSONWebSignatureSerializer, UserMixin και current_app
Σε αυτό το αρχείο υπάρχει η δημιουργία της βάσης για τον χρήστη και αντιστοίχων των άρθρων που θα ανεβάζει κάθε χρήστης.
Το αρχείο config.py γίνεται η διαμόρφωση των στοιχείων SECRET_KEY, SQLALCHEMY_DATABASE_URI, MAIL_SERVER, MAIL_PORT, MAIL_USE_TLS, MAIL_USERNAME και MAIL_PASSWORD

 
Ανάλυση δομής packages
Σε αυτήν την ενότητα θα επεξηγηθεί αναλυτικά ο τρόπος λειτουργείας ενός package και αντίστοιχα κάθε package που έχει δημιουργηθεί λειτουργεί με το παρόμοιο τρόπο και δεν θα γίνει αναλυτική αναφορά. 
Για να μην γίνει ο κώδικας δύσκολος στην ανάγνωση από τα δεδομένα της φόρμας που θα υποβληθούν από την προβολή του προγράμματος περιήγησης και για τα δύο packages, users και posts έγινε χρήση βιβλιοθήκης WTForm, flask_wtf, wtforms.validators. Βλέπε εικόνα 4
 
Εικόνα 4 Users package
Users – Forms

Για το package users χρησιμοποιήθηκαν οι λειτουργίες FlaskForm, FileField, FileAllowed, StringField, PasswordField, SubmitField, BooleanField, DataRequiered, Length, Email, EqualTo, ValidationError.
Τα classes που δημιουργήθηκαν για το user package είναι:
o	RegistrationForm
o	LoginForm
o	UpdateAccountForm
o	RequestResetForm
o	ResetPasswordForm
Για τη δημιουργία αυτών των ελέγχων έγινε η χρήση της λέξης κλειδί def για τη δήλωση της λειτουργίας και μετά η δήλωση του ονόματος της λειτουργείας. Μέσα στην παρένθεση έγινε η δήλωση των παραμέτρων της εκάστοτε λειτουργίας και μετά την άνω και κάτω τελεία γίνεται η δήλωση if για τον έλεγχο των παρακάτω.
Για τα classes RegistrationForm, UpdateAccountForm, RequestResetForm δημιουργήθηκαν λειτουργίες ελέγχου validators που θα δείχνει στον χρήστη αν το username και το email είναι διαθέσιμο, αν υπάρχει συγκεκριμένος λογαριασμός αποθηκευμένος στην βάση για τη δυνατότητα ανανέωσης και αν ο κωδικός στην λειτουργία  ResetPasswordForm είναι ίδιος με τον κωδικό επιβεβαίωσης που ζητάει η φόρμα.

Users – Routes

Για να γίνει χρήση, στις παραπάνω φόρμες έγινε δημιουργία module routes.py.
Η χρήση routes.py γίνεται για να υπάρχει μια σαφώς καθορισμένη δρομολόγηση που θα εξοικονομήσει χρόνο κατά την αναζήτηση, αλλά και για να είναι όλες οι URL διευθύνσεις συγκεντρωμένες σε ένα σημείο.
Από την flask έχουν εισήχθη οι λειτουργίες render_template, url_for, flash, redirect, request, Blueprint
Βλέπουμε στην εικόνα 5 ότι καταρχάς κάνουμε χρήση και GET και POST μιας και θέλουμε να ζητήσουμε δεδομένα από τη βάση αλλά και να βάλουμε δεδομένα στη βάση αντίστοιχα.
 
•	Ποιο συγκεκριμένα με τη λειτουργία bcrypt παρέχεται η δυνατότητα απόκρυψης του κωδικού πρόσβασης κάθε χρήστη. 
•	Με τη λειτουργία flash δίνονται feedback στον χρήστη.
•	Με τη λειτουργία render_template του flask αναπαράγει το αρχείο HTML που βρίσκετε κάτω από το φάκελο templates της εφαρμογής και έτσι αποφεύγετε η χρήση hardcode HTML.
•	Η λειτουργία url_for χρησιμοποιήθηκε για να δώσει στην εφαρμογή ευκολία στην αλλαγή διεύθυνσης με μία κίνηση. 
•	Η λειτουργία redirect χρησιμοποιήθηκε για να κατευθύνει τον χρήστη σε άλλη  σελίδα.
•	Η λειτουργία request χρησιμοποιήθηκε για να μπορεί ο χρήστης να καλεί δεδομένα από τη βάση.
•	Η λειτουργία blueprint χρησιμοποιήθηκε αντίστοιχα για να απλοποιηθεί η εφαρμογή σε packages.
Users – utils.py

Το module utils.py περιέχει λειτουργίες που έχουν να κάνουν με τον τρόπο αποθήκευσης της εικόνας profile του χρήστη αλλά και τη λειτουργία αποστολής email σε περίπτωση απώλειας κωδικού πρόσβασης. Βλέπε εικόνα 6
 
Εικόνα 6 Users Utils

Για τις παραπάνω λειτουργίες χρησιμοποιήθηκαν οι λειτουργίες url_for, current_app, Message, secrets και os αντίστοιχα από διαφορετικές βιβλιοθήκες.
Η λειτουργία Image της βιβλιοθήκης PIL παρέχει τη δυνατότητα μορφοποίησης εικόνων και γραφικών. Στη συγκεκριμένη περίπτωση χρησιμοποιήθηκε για την αποθήκευση εικόνων σε συγκεκριμένο μέγεθος.
Η λειτουργία os χρησιμοποιήθηκε για το χειρισμό μονοπατιών αποθήκευσης εικόνας στην εφαρμογή. Ο χρήστης θα μπορεί να αποθηκεύει δική του εικόνα προφίλ.
Η λειτουργία Message του flask_mail είναι μία απλή διεπαφή για να  στηθεί SMTP στην εφαρμογή  και να υπάρχει η δυνατότητα αποστολής email σε περίπτωση που ο χρήστης ξεχάσει τον κωδικό του.

|Ανάλυση Επιπέδου 3 – DataBase

Για τη δημιουργία επιπέδου γίνεται χρήση SQLAlchemy κάνοντας εγκατάσταση του πακέτου ανοίγοντας το windows terminal και κάνοντας ένα pip install flask-sqlalchemy.
Στο βασικό module _init__.py της εφαρμογής γίνεται η λήψη της SQLAlchemy, όπως φαίνεται στην εικόνα 7
 
Εικόνα 7 __init__.py basic application file
Μετά τη λήψη της SQLAlchemy δηλώνεται η τοποθεσία URI της βάσης. Για τη συγκεκριμένη εργασία έχει γίνει χρήση SQL lite που ουσιαστικά σημαίνει πως η βάση δεδομένων είναι ένα αρχείο στο φάκελο που είναι η εφαρμογή.
Η δήλωση αυτή γίνεται στο config.py αρχείο  Όπως φαίνεται και στην εικόνα 8. 
 
Εικόνα 8 config.py basic application file
Η δομή της βάσης δεδομένων δημιουργείται στο αρχείο models.py όπου κάθε class είναι και ένας διαφορετικός πίνακας όπως φαίνεται στην εικόνα 9.
 
Εικόνα 9 models.py basic application file
Οι πίνακες που δημιουργήθηκαν για αυτήν την εφαρμογή είναι δύο:
•	users
•	Post
Στον πίνακα user δημιουργήθηκαν οι στήλες id όπου είναι και το πρωτεύον κλειδί, username , email, image_file, password, posts.
Οι στήλες username και email έχουν τον περιορισμό ότι πρέπει να είναι μοναδικές.
Ο πίνακας Post έχει τις στήλες id που είναι και πάλι πρωτεύον κλειδί, title, date_posted που συμπληρώνεται αυτόματα από τη λειτουργία datetime, content, user_id το οποίο είναι ForeignKey. 
Η σχέση μεταξύ των δύο πινάκων φαίνεται στην εικόνα 10


 Έλεγχος εισαγωγής, ανανέωσης και διαγραφής άρθρου
   
Κριτική αξιολόγηση.
Η web αυτή εφαρμογή υλοποιήθηκε με σκοπό να δημιουργηθεί μία πολυ-επίπεδη κατανεμημένη εφαρμογή για intranet(multi-tiered distributed intranet application).   Για την ολοκλήρωση της εφαρμογής χρειάστηκαν 3 οχτάωρα.
Πρώτα έγινε η σχεδίαση της εφαρμογής έχοντας υπόψη τη χρειάζεται ένα Personal Blog.
Ακολούθησε η εγγραφή κώδικα σε μέσα σε περιβάλλον PyCharm.
Είναι μία ολοκληρωμένη εφαρμογή με δυνατότητα απομόνωσης την 3 επιπέδων της και έτσι την κάνει λειτουργικά εύκολη στην όποια αναβάθμιση και αλλαγή μπορεί να χρειαστεί μελλοντικά.
